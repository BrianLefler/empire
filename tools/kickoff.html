<html>
	<head>
		<script src="../frontend/server.js"></script>
		<script>
			function postFormStartLobby() {
				let gameId = parseInt(document.getElementById("gameIdLobby").value);
				
				let req = new XMLHttpRequest();
				req.open("post", g_server + "/entry/startlobby?gid=" + gameId, true);
				req.onerror = function (e) {
					window.alert(req.status);
				};
				req.onload = function (ev) {
					window.alert(req.status);
				};
				req.send(JSON.stringify({
					"players": parseInt(document.getElementById("numPlayers").value),
					"schedule": {
						"times": Array.from(document.getElementById("times").selectedOptions).map(e => parseInt(e.value)),
						"days": Array.from(document.getElementById("daysOfWeek").selectedOptions).map(e => e.value),
						"locale": "America/Los_Angeles"
					}
				}));
				return false;
			}

			function postFormStartWorld() {
				let pw = document.getElementById("gmPassword").value;
				let pw2 = document.getElementById("obsPassword").value;
				let gameId = parseInt(document.getElementById("gameId").value);
				
				let req = new XMLHttpRequest();
				req.open("post", g_server + "/entry/startworld?gid=" + gameId, true);
				req.onerror = function (e) {
					window.alert(req.status);
				};
				req.onload = function (ev) {
					window.alert(req.status);
				};
				req.send(JSON.stringify({
					"gm_password": pw,
					"obs_password": pw2
				}));
				return false;
			}

			function postFormMigrate() {
				let req = new XMLHttpRequest();
				req.open("post", g_server + "/entry/migrate", true);
				req.onerror = function (e) {
					window.alert(req.status);
				};
				req.onload = function (ev) {
					window.alert(req.status);
				};
				req.send();
				return false;
			}
		</script>
	</head>
	<body>
		<h1>Start Lobby</h1>
		<form onsubmit="return postFormStartLobby();">
			<label>Game ID: <input id="gameIdLobby" type="number" value="0"/></label>
			<label>Number of Players: <input id="numPlayers" type="number" value="26"/></label>
			<label>Days Of Week: <select id="daysOfWeek" multiple>
				<option>MONDAY</option>
				<option>TUESDAY</option>
				<option>WEDNESDAY</option>
				<option>THURSDAY</option>
				<option>FRIDAY</option>
				<option>SATURDAY</option>
				<option>SUNDAY</option>
			</select></label>
			<label>Time(s) (America/Los_Angeles): <select id="times" multiple></select></label>
			<button>Create Lobby</button>
		</form>
		<h1>Start Game</h1>
		<form onsubmit="return postFormStartWorld();">
			<label>GM Password: <input id="gmPassword" type="password"/></label>
			<label>Observer Password: <input id="obsPassword" type="password"/></label>
			<label>Game ID: <input id="gameId" type="number"/></label>
			<button>Start</button>
		</form>
		<h1>Trigger Server-Side Migration</h1>
		<form onsubmit="return postFormMigrate();">
			<button>Trigger Migrate (DANGEROUS)</button>
		</form>
		<h1>Advance Game</h1>
		<div id="advances"></div>
		<script>
			for (let i = 1; i < 30; i++) {
				let f = document.createElement("form");
				f.setAttribute("action", g_server + "/entry/advanceworld?gid=0&t=" + i);
				f.setAttribute("method", "POST");
				let b = document.createElement("button");
				b.appendChild(document.createTextNode("Advance game 0 turn " + i));
				f.appendChild(b);
				document.getElementById("advances").appendChild(f);
			}
			for (let i = 0; i < 60 / 5 * 24; i++) {
				let o = document.createElement("option");
				o.setAttribute("value", i * 5);
				o.appendChild(document.createTextNode(Math.floor(i * 5 / 60).toString().padStart(2, "0") + ":" + ((i * 5) % 60).toString().padStart(2, "0")));
				document.getElementById("times").appendChild(o);
			}
		</script>
	</body>
</html>
